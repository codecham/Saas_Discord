# üìä Roadmap des Statistiques et √âv√©nements Discord

## üìä Vue d'ensemble

**Date de cr√©ation:** Octobre 2025  
**Version:** 1.0.0  
**Statut global:** 0/32 t√¢ches compl√©t√©es (0%)

**Objectif:** Syst√®me complet de collecte, agr√©gation et visualisation de statistiques Discord scalable pour 50k+ serveurs.

---

## üìà Progression globale

```
Phase 1 - MVP:        ‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0/27 (0%)
Phase 2 - Scaling:    ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0/5 (0%)
```

**Temps estim√© total:** 6-8 semaines (Phase 1)  
**Temps investi:** 0 heures  

---

## üéØ Phase 1 - MVP (6-8 semaines)

### üìÖ Semaine 1-2 : Mod√©ration (0/8)

**Objectif:** Tracking complet des actions de mod√©ration

#### ‚ö†Ô∏è T√¢che #1 - Table moderation_logs
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 30 minutes

**Actions:**
- [ ] Cr√©er migration Prisma pour table `moderation_logs`
- [ ] D√©finir sch√©ma avec champs : guildId, action, targetUserId, moderatorId, reason, timestamp, details (JSONB)
- [ ] Cr√©er index sur guildId, targetUserId, moderatorId, timestamp
- [ ] Ex√©cuter migration : `npx prisma migrate dev --name add_moderation_logs`
- [ ] V√©rifier table cr√©√©e dans PostgreSQL

**Fichiers √† cr√©er/modifier:**
- `apps/backend/prisma/schema.prisma`
- `apps/backend/prisma/migrations/XXX_add_moderation_logs/`

---

#### ‚ö†Ô∏è T√¢che #2 - Listener guildBanAdd
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 2 heures

**Actions:**
- [ ] Cr√©er `apps/bot/src/listeners/moderation/guildBanAdd.ts`
- [ ] R√©cup√©rer audit log pour identifier le mod√©rateur
- [ ] Cr√©er BotEventDto avec BanEventData
- [ ] Tester avec ban manuel sur serveur dev
- [ ] V√©rifier r√©ception dans logs Backend

**Fichiers √† cr√©er:**
- `apps/bot/src/listeners/moderation/guildBanAdd.ts`

**D√©pendances:**
- Structure BotEventDto existante ‚úÖ
- BanEventData interface ‚úÖ
- EventBatcher configur√© ‚úÖ

---

#### ‚ö†Ô∏è T√¢che #3 - Listener guildBanRemove
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 1 heure

**Actions:**
- [ ] Cr√©er `apps/bot/src/listeners/moderation/guildBanRemove.ts`
- [ ] R√©cup√©rer audit log pour mod√©rateur
- [ ] Cr√©er BotEventDto avec UnbanEventData
- [ ] Tester avec unban manuel

**Fichiers √† cr√©er:**
- `apps/bot/src/listeners/moderation/guildBanRemove.ts`

---

#### ‚ö†Ô∏è T√¢che #4 - Listener guildMemberRemove
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 2 heures

**Actions:**
- [ ] Cr√©er `apps/bot/src/listeners/moderation/guildMemberRemove.ts`
- [ ] D√©tecter kick vs leave naturel via audit log
- [ ] R√©cup√©rer roles et joinedAt du membre
- [ ] Cr√©er BotEventDto avec MemberRemoveEventData
- [ ] Tester les deux cas (kick ET leave)

**Fichiers √† cr√©er:**
- `apps/bot/src/listeners/moderation/guildMemberRemove.ts`

---

#### ‚ö†Ô∏è T√¢che #5 - Backend handler handleBan
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 1 heure

**Actions:**
- [ ] Ajouter case `GUILD_BAN_ADD` dans BotEventHandlerService
- [ ] Impl√©menter m√©thode `handleBan(event: BotEventDto)`
- [ ] INSERT dans moderation_logs avec Prisma
- [ ] Cr√©er tests unitaires (3 tests minimum)
- [ ] Tester end-to-end : ban Discord ‚Üí DB

**Fichiers √† modifier:**
- `apps/backend/src/modules/gateway/services/bot-event-handler.service.ts`

**Tests √† cr√©er:**
- Ban avec mod√©rateur
- Ban sans mod√©rateur (syst√®me)
- Ban avec raison

---

#### ‚ö†Ô∏è T√¢che #6 - Backend handler handleUnban
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 30 minutes

**Actions:**
- [ ] Ajouter case `GUILD_BAN_REMOVE`
- [ ] Impl√©menter `handleUnban()`
- [ ] INSERT dans moderation_logs
- [ ] Tests unitaires

**Fichiers √† modifier:**
- `apps/backend/src/modules/gateway/services/bot-event-handler.service.ts`

---

#### ‚ö†Ô∏è T√¢che #7 - Backend handler handleMemberRemove
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 1 heure

**Actions:**
- [ ] Ajouter case `GUILD_MEMBER_REMOVE`
- [ ] Impl√©menter `handleMemberRemove()`
- [ ] Diff√©rencier kick vs leave dans action
- [ ] Tests unitaires (kick ET leave)

**Fichiers √† modifier:**
- `apps/backend/src/modules/gateway/services/bot-event-handler.service.ts`

---

#### ‚ö†Ô∏è T√¢che #8 - Tests end-to-end mod√©ration
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üü† IMPORTANT  
**Effort estim√©:** 1 heure

**Actions:**
- [ ] Cr√©er serveur Discord de test
- [ ] Tester ban ‚Üí v√©rifier DB
- [ ] Tester unban ‚Üí v√©rifier DB
- [ ] Tester kick ‚Üí v√©rifier DB
- [ ] Tester leave naturel ‚Üí v√©rifier DB
- [ ] V√©rifier tous les champs remplis correctement
- [ ] Documenter proc√©dure de test

**Livrable:** Historique mod√©ration fonctionnel et test√©

---

### üìÖ Semaine 3 : Invitations (0/7)

**Objectif:** Tracker qui invite qui

#### ‚ö†Ô∏è T√¢che #9 - Table invite_tracking
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 30 minutes

**Actions:**
- [ ] Cr√©er migration Prisma pour `invite_tracking`
- [ ] Sch√©ma : guildId, inviteCode, inviterId, inviteeId, invitedAt, etc.
- [ ] Index sur guildId, inviterId, inviteeId
- [ ] Ex√©cuter migration

**Fichiers √† modifier:**
- `apps/backend/prisma/schema.prisma`

---

#### ‚ö†Ô∏è T√¢che #10 - Service InviteTracker
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 2 heures

**Actions:**
- [ ] Cr√©er `apps/bot/src/services/inviteTracker.service.ts`
- [ ] Cache Map des invites par guild
- [ ] M√©thode `cacheGuildInvites(guildId)`
- [ ] M√©thode `detectUsedInvite(guildId, beforeInvites, afterInvites)`
- [ ] M√©thode `getInvite(guildId, code)`
- [ ] Tests unitaires du service

**Fichiers √† cr√©er:**
- `apps/bot/src/services/inviteTracker.service.ts`

---

#### ‚ö†Ô∏è T√¢che #11 - Listener inviteCreate
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 1 heure

**Actions:**
- [ ] Cr√©er `apps/bot/src/listeners/invite/inviteCreate.ts`
- [ ] Ajouter invite au cache InviteTracker
- [ ] Cr√©er BotEventDto avec InviteCreateEventData
- [ ] Tester cr√©ation invite

**Fichiers √† cr√©er:**
- `apps/bot/src/listeners/invite/inviteCreate.ts`

---

#### ‚ö†Ô∏è T√¢che #12 - Listener inviteDelete
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 30 minutes

**Actions:**
- [ ] Cr√©er `apps/bot/src/listeners/invite/inviteDelete.ts`
- [ ] Retirer invite du cache
- [ ] Cr√©er BotEventDto avec InviteDeleteEventData

**Fichiers √† cr√©er:**
- `apps/bot/src/listeners/invite/inviteDelete.ts`

---

#### ‚ö†Ô∏è T√¢che #13 - Modifier guildMemberAdd pour tracking
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 2 heures

**Actions:**
- [ ] Modifier listener `guildMemberAdd.ts` existant
- [ ] Avant join : fetch invites (ou utiliser cache)
- [ ] Apr√®s join : fetch invites √† nouveau
- [ ] Appeler `inviteTracker.detectUsedInvite()`
- [ ] Si d√©tect√© : cr√©er event INVITE_USE
- [ ] Cr√©er aussi event GUILD_MEMBER_ADD avec inviter info
- [ ] Tester avec vraie invitation

**Fichiers √† modifier:**
- `apps/bot/src/listeners/member/guildMemberAdd.ts` (ou cr√©er si n'existe pas)

---

#### ‚ö†Ô∏è T√¢che #14 - Backend handlers invitations
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 1 heure

**Actions:**
- [ ] Ajouter case `INVITE_USE` dans handler
- [ ] Impl√©menter `handleInviteUse()`
- [ ] INSERT dans invite_tracking
- [ ] Tests unitaires

**Fichiers √† modifier:**
- `apps/backend/src/modules/gateway/services/bot-event-handler.service.ts`

---

#### ‚ö†Ô∏è T√¢che #15 - API endpoint invite stats
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üü† IMPORTANT  
**Effort estim√©:** 1 heure

**Actions:**
- [ ] Cr√©er `GET /api/guilds/:guildId/invite-stats`
- [ ] Calculer top recruteurs (membres avec le plus d'invit√©s)
- [ ] Compter invites actives vs utilis√©es
- [ ] Retourner DTO avec stats
- [ ] Tester endpoint

**Fichiers √† cr√©er:**
- Controller dans module guilds

**Livrable:** Stats d'invitation fonctionnelles

---

### üìÖ Semaine 4 : Agr√©gation messages/vocal (0/8)

**Objectif:** Premi√®re version metrics snapshot

#### ‚ö†Ô∏è T√¢che #16 - Service MetricsCollector
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 4 heures

**Actions:**
- [ ] Cr√©er `apps/bot/src/services/metricsCollector.service.ts`
- [ ] Map en m√©moire des compteurs par guild
- [ ] M√©thode `incrementMessage(guildId, channelId, userId)`
- [ ] M√©thode `trackVoiceSession(guildId, channelId, userId, durationMin)`
- [ ] M√©thode `trackReaction(guildId, emoji)`
- [ ] Timer flush automatique (60s)
- [ ] M√©thode `flush(guildId)` ‚Üí g√©n√®re MetricsSnapshotData
- [ ] M√©thode `generateSnapshot()` avec calculs agr√©gats
- [ ] Helpers pour r√©cup√©rer noms channels/users
- [ ] Tests unitaires du service

**Fichiers √† cr√©er:**
- `apps/bot/src/services/metricsCollector.service.ts`

---

#### ‚ö†Ô∏è T√¢che #17 - Modifier listener messageCreate
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 30 minutes

**Actions:**
- [ ] Modifier `apps/bot/src/listeners/message/messageCreate.ts`
- [ ] Appeler `metricsCollector.incrementMessage()`
- [ ] Ne PAS envoyer d'√©v√©nement individuel
- [ ] Tester avec plusieurs messages

**Fichiers √† modifier:**
- `apps/bot/src/listeners/message/messageCreate.ts`

---

#### ‚ö†Ô∏è T√¢che #18 - Listener voiceStateUpdate
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 2 heures

**Actions:**
- [ ] Cr√©er `apps/bot/src/listeners/voice/voiceStateUpdate.ts`
- [ ] D√©tecter join vocal (oldState.channel null, newState.channel pr√©sent)
- [ ] D√©tecter leave vocal (oldState.channel pr√©sent, newState.channel null)
- [ ] D√©tecter move (changement de channel)
- [ ] Calculer dur√©e session pour leave
- [ ] Appeler `metricsCollector.trackVoiceSession()`
- [ ] Tester les 3 cas

**Fichiers √† cr√©er:**
- `apps/bot/src/listeners/voice/voiceStateUpdate.ts`

---

#### ‚ö†Ô∏è T√¢che #19 - Table metrics_snapshots
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 30 minutes

**Actions:**
- [ ] Cr√©er migration Prisma
- [ ] Champs : guildId, periodStart, periodEnd, periodDuration, data (JSONB), compteurs extraits
- [ ] Index sur guildId + periodStart DESC
- [ ] Index GIN sur data (JSONB)
- [ ] Ex√©cuter migration

**Fichiers √† modifier:**
- `apps/backend/prisma/schema.prisma`

---

#### ‚ö†Ô∏è T√¢che #20 - Table member_stats
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 30 minutes

**Actions:**
- [ ] Cr√©er migration Prisma
- [ ] Champs cumul√©s : totalMessages, totalVoiceMinutes, totalReactions
- [ ] Champs quotidiens/hebdomadaires avec reset
- [ ] Constraint UNIQUE sur (guildId, userId)
- [ ] Index sur guildId + compteurs DESC
- [ ] Ex√©cuter migration

**Fichiers √† modifier:**
- `apps/backend/prisma/schema.prisma`

---

#### ‚ö†Ô∏è T√¢che #21 - Backend handler handleMetricsSnapshot
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 2 heures

**Actions:**
- [ ] Ajouter case `METRICS_SNAPSHOT`
- [ ] Impl√©menter `handleMetricsSnapshot()`
- [ ] INSERT snapshot complet dans metrics_snapshots
- [ ] Upsert member_stats pour chaque membre actif (increment totaux)
- [ ] G√©rer daily/weekly reset
- [ ] Tests unitaires
- [ ] Tester avec snapshot r√©el

**Fichiers √† modifier:**
- `apps/backend/src/modules/gateway/services/bot-event-handler.service.ts`

---

#### ‚ö†Ô∏è T√¢che #22 - Initialiser MetricsCollector au boot
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 30 minutes

**Actions:**
- [ ] Instancier MetricsCollector dans container Sapphire
- [ ] Ajouter dans `apps/bot/src/index.ts` ou listener ready
- [ ] V√©rifier accessible via `container.metricsCollector`

**Fichiers √† modifier:**
- `apps/bot/src/index.ts` ou `apps/bot/src/listeners/ready.ts`

---

#### ‚ö†Ô∏è T√¢che #23 - Tests m√©triques end-to-end
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üü† IMPORTANT  
**Effort estim√©:** 1 heure

**Actions:**
- [ ] Envoyer 10-20 messages sur serveur dev
- [ ] Attendre 1 minute (flush)
- [ ] V√©rifier snapshot dans DB (metrics_snapshots)
- [ ] V√©rifier member_stats mis √† jour
- [ ] Join vocal 2 minutes ‚Üí v√©rifier tracking
- [ ] Valider tous les compteurs corrects

**Livrable:** Compteurs messages/vocal fonctionnels

---

### üìÖ Semaine 5 : Dashboard Frontend (0/4)

**Objectif:** Premi√®re visualisation des stats

#### ‚ö†Ô∏è T√¢che #24 - Backend endpoint GET /guilds/:id/stats/overview
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 2 heures

**Actions:**
- [ ] Cr√©er GuildStatsController ou ajouter dans GuildsController
- [ ] Endpoint retourne : total messages/vocal today/week/month
- [ ] Top 10 channels actifs
- [ ] Top 10 membres actifs
- [ ] Requ√™tes Prisma optimis√©es avec agr√©gations
- [ ] Tester endpoint avec Postman

**Fichiers √† cr√©er/modifier:**
- Controller + Service dans apps/backend

---

#### ‚ö†Ô∏è T√¢che #25 - Backend endpoint GET /guilds/:id/moderation/recent
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 1 heure

**Actions:**
- [ ] Endpoint retourne 50 derni√®res actions mod√©ration
- [ ] Tri par timestamp DESC
- [ ] Include d√©tails complets (mod√©rateur, cible, raison)
- [ ] Pagination possible (optionnel)
- [ ] Tester endpoint

**Fichiers √† cr√©er/modifier:**
- Controller mod√©ration

---

#### ‚ö†Ô∏è T√¢che #26 - Frontend component GuildDashboardComponent
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 3 heures

**Actions:**
- [ ] Cr√©er component `apps/sakai/src/app/features/guild-dashboard/`
- [ ] Cards PrimeNG avec stats principales (messages, vocal, membres)
- [ ] Graph Chart.js activit√© derni√®re semaine
- [ ] Tableau mod√©ration r√©cente (PrimeTable)
- [ ] Service facade pour appels API
- [ ] Routing vers `/guilds/:id/dashboard`
- [ ] Tester affichage avec donn√©es r√©elles

**Fichiers √† cr√©er:**
- Component, template, service, routing

---

#### ‚ö†Ô∏è T√¢che #27 - Frontend component LeaderboardComponent
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üü† IMPORTANT  
**Effort estim√©:** 2 heures

**Actions:**
- [ ] Cr√©er component leaderboard
- [ ] Tabs : Top messages / Top vocal / Top activit√© globale
- [ ] DataView PrimeNG avec avatars membres
- [ ] Tri dynamique
- [ ] Design responsive
- [ ] Tester affichage

**Fichiers √† cr√©er:**
- Component leaderboard

**Livrable:** Dashboard fonctionnel avec donn√©es r√©elles

---

### üìÖ Semaine 6 : Polish & Tests (0/5)

**Objectif:** Finaliser MVP et pr√©parer d√©ploiement

#### ‚ö†Ô∏è T√¢che #28 - Tests end-to-end complet
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üî¥ CRITIQUE  
**Effort estim√©:** 3 heures

**Actions:**
- [ ] Sc√©nario 1 : Ban ‚Üí v√©rifier dashboard
- [ ] Sc√©nario 2 : 100 messages ‚Üí v√©rifier stats
- [ ] Sc√©nario 3 : Vocal 10 min ‚Üí v√©rifier compteurs
- [ ] Sc√©nario 4 : Invitation utilis√©e ‚Üí v√©rifier tracking
- [ ] V√©rifier tous les flows bout en bout
- [ ] Documenter proc√©dures de test

---

#### ‚ö†Ô∏è T√¢che #29 - Gestion erreurs et edge cases
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üü† IMPORTANT  
**Effort estim√©:** 2 heures

**Actions:**
- [ ] G√©rer bot offline ‚Üí backup SQLite fonctionne
- [ ] G√©rer gateway down ‚Üí retry automatique
- [ ] G√©rer DB erreurs ‚Üí logs Sentry
- [ ] G√©rer donn√©es manquantes (membre inconnu, etc.)
- [ ] Try/catch partout avec logs appropri√©s

---

#### ‚ö†Ô∏è T√¢che #30 - Documentation utilisateur
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üü† IMPORTANT  
**Effort estim√©:** 2 heures

**Actions:**
- [ ] Guide utilisation dashboard
- [ ] Explication des m√©triques
- [ ] FAQ stats
- [ ] Screenshots/vid√©os d√©mo

---

#### ‚ö†Ô∏è T√¢che #31 - Optimisation requ√™tes DB
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üü° OPTIMISATION  
**Effort estim√©:** 2 heures

**Actions:**
- [ ] EXPLAIN ANALYZE sur requ√™tes lourdes
- [ ] V√©rifier usage des index
- [ ] Optimiser agr√©gations
- [ ] Tester avec 1000+ rows

---

#### ‚ö†Ô∏è T√¢che #32 - Tests charge
**Statut:** ‚ö†Ô∏è √Ä FAIRE  
**Priorit√©:** üü° OPTIMISATION  
**Effort estim√©:** 2 heures

**Actions:**
- [ ] Simuler 1000 messages/min sur 1 serveur
- [ ] V√©rifier latence < 2s pour snapshots
- [ ] V√©rifier RAM bot < 512MB
- [ ] V√©rifier CPU < 30%
- [ ] Documenter limites d√©tect√©es

**Livrable:** MVP pr√™t pour beta test sur 5-10 serveurs

---

## üéØ Phase 2 - Scaling (2-3 mois)

### Futures fonctionnalit√©s

#### ‚ö†Ô∏è T√¢che #33 - R√©actions tracking d√©taill√©
**Statut:** ‚ö†Ô∏è √Ä FAIRE (Phase 2)  
**Priorit√©:** üü¢ FUTUR

#### ‚ö†Ô∏è T√¢che #34 - Member activity snapshot d√©taill√©
**Statut:** ‚ö†Ô∏è √Ä FAIRE (Phase 2)  
**Priorit√©:** üü¢ FUTUR

#### ‚ö†Ô∏è T√¢che #35 - Sharding bot (>2500 serveurs)
**Statut:** ‚ö†Ô∏è √Ä FAIRE (Phase 2)  
**Priorit√©:** üü¢ FUTUR

#### ‚ö†Ô∏è T√¢che #36 - Partitioning PostgreSQL
**Statut:** ‚ö†Ô∏è √Ä FAIRE (Phase 2)  
**Priorit√©:** üü¢ FUTUR

#### ‚ö†Ô∏è T√¢che #37 - WebSocket temps r√©el Frontend
**Statut:** ‚ö†Ô∏è √Ä FAIRE (Phase 2)  
**Priorit√©:** üü¢ FUTUR

---

## üìä Tableau r√©capitulatif Phase 1

| # | T√¢che | Semaine | Priorit√© | Statut | Effort |
|---|-------|---------|----------|--------|--------|
| 1 | Table moderation_logs | S1 | üî¥ | ‚ö†Ô∏è | 30m |
| 2 | Listener guildBanAdd | S1 | üî¥ | ‚ö†Ô∏è | 2h |
| 3 | Listener guildBanRemove | S1 | üî¥ | ‚ö†Ô∏è | 1h |
| 4 | Listener guildMemberRemove | S1 | üî¥ | ‚ö†Ô∏è | 2h |
| 5 | Handler handleBan | S1 | üî¥ | ‚ö†Ô∏è | 1h |
| 6 | Handler handleUnban | S1 | üî¥ | ‚ö†Ô∏è | 30m |
| 7 | Handler handleMemberRemove | S2 | üî¥ | ‚ö†Ô∏è | 1h |
| 8 | Tests E2E mod√©ration | S2 | üü† | ‚ö†Ô∏è | 1h |
| 9 | Table invite_tracking | S3 | üî¥ | ‚ö†Ô∏è | 30m |
| 10 | Service InviteTracker | S3 | üî¥ | ‚ö†Ô∏è | 2h |
| 11 | Listener inviteCreate | S3 | üî¥ | ‚ö†Ô∏è | 1h |
| 12 | Listener inviteDelete | S3 | üî¥ | ‚ö†Ô∏è | 30m |
| 13 | Modifier guildMemberAdd | S3 | üî¥ | ‚ö†Ô∏è | 2h |
| 14 | Handler invitations | S3 | üî¥ | ‚ö†Ô∏è | 1h |
| 15 | API invite stats | S3 | üü† | ‚ö†Ô∏è | 1h |
| 16 | Service MetricsCollector | S4 | üî¥ | ‚ö†Ô∏è | 4h |
| 17 | Modifier messageCreate | S4 | üî¥ | ‚ö†Ô∏è | 30m |
| 18 | Listener voiceStateUpdate | S4 | üî¥ | ‚ö†Ô∏è | 2h |
| 19 | Table metrics_snapshots | S4 | üî¥ | ‚ö†Ô∏è | 30m |
| 20 | Table member_stats | S4 | üî¥ | ‚ö†Ô∏è | 30m |
| 21 | Handler handleMetricsSnapshot | S4 | üî¥ | ‚ö†Ô∏è | 2h |
| 22 | Init MetricsCollector | S4 | üî¥ | ‚ö†Ô∏è | 30m |
| 23 | Tests E2E m√©triques | S4 | üü† | ‚ö†Ô∏è | 1h |
| 24 | API stats overview | S5 | üî¥ | ‚ö†Ô∏è | 2h |
| 25 | API moderation recent | S5 | üî¥ | ‚ö†Ô∏è | 1h |
| 26 | Component GuildDashboard | S5 | üî¥ | ‚ö†Ô∏è | 3h |
| 27 | Component Leaderboard | S5 | üü† | ‚ö†Ô∏è | 2h |
| 28 | Tests E2E complet | S6 | üî¥ | ‚ö†Ô∏è | 3h |
| 29 | Gestion erreurs | S6 | üü† | ‚ö†Ô∏è | 2h |
| 30 | Documentation utilisateur | S6 | üü† | ‚ö†Ô∏è | 2h |
| 31 | Optimisation DB | S6 | üü° | ‚ö†Ô∏è | 2h |
| 32 | Tests charge | S6 | üü° | ‚ö†Ô∏è | 2h |

**Total Phase 1:** ~48 heures sur 6 semaines

---

## üìö Ressources

### Documentation technique
- `docs/STATS_ARCHITECTURE.md` - Architecture compl√®te ‚úÖ
- `packages/shared-types/src/dtos/events/bot-event.dto.ts` - DTOs ‚úÖ
- `packages/shared-types/src/enums/eventTypes.enum.ts` - Types √©v√©nements ‚úÖ

### Exemples de code
- Voir STATS_ARCHITECTURE.md sections "Exemples pratiques"

---

## ‚úÖ Checklist avant de commencer chaque t√¢che

- [ ] Lire la description compl√®te de la t√¢che
- [ ] V√©rifier les d√©pendances (t√¢ches pr√©c√©dentes compl√©t√©es)
- [ ] Cr√©er une branche git : `git checkout -b stats/task-XX`
- [ ] Lire la section correspondante dans STATS_ARCHITECTURE.md
- [ ] Avoir le serveur Discord de test pr√™t

---

## ‚úÖ Checklist apr√®s avoir compl√©t√© une t√¢che

- [ ] Tests unitaires cr√©√©s et passent (si applicable)
- [ ] Tests end-to-end passent (si applicable)
- [ ] Code format√© et lint propre
- [ ] Commit avec message clair : `feat(stats): implement task #XX - description`
- [ ] Mettre √† jour cette roadmap (cocher ‚úÖ la t√¢che)
- [ ] Mettre √† jour le statut dans le tableau r√©capitulatif
- [ ] Documenter tout changement important dans STATS_ARCHITECTURE.md
- [ ] Merge dans main si tout OK

---

## üéØ Plan d'action recommand√©

### Sprint 1 - Mod√©ration (Semaines 1-2)
**Objectif:** Historique mod√©ration complet fonctionnel

**Ordre d'ex√©cution:**
1. T√¢che #1 - Table moderation_logs
2. T√¢che #2 - Listener guildBanAdd
3. T√¢che #5 - Handler handleBan
4. Tester ban manuel ‚Üí v√©rifier DB ‚úÖ
5. T√¢che #3 - Listener guildBanRemove
6. T√¢che #6 - Handler handleUnban
7. Tester unban manuel ‚Üí v√©rifier DB ‚úÖ
8. T√¢che #4 - Listener guildMemberRemove
9. T√¢che #7 - Handler handleMemberRemove
10. T√¢che #8 - Tests E2E complet mod√©ration

**Livrable:** Logs mod√©ration dans PostgreSQL, consultables

---

### Sprint 2 - Invitations (Semaine 3)
**Objectif:** Syst√®me de tracking invitations

**Ordre d'ex√©cution:**
1. T√¢che #9 - Table invite_tracking
2. T√¢che #10 - Service InviteTracker
3. Tester service isol√©ment avec tests unitaires ‚úÖ
4. T√¢che #11 - Listener inviteCreate
5. T√¢che #12 - Listener inviteDelete
6. T√¢che #13 - Modifier guildMemberAdd
7. Tester vraie invitation ‚Üí v√©rifier d√©tection ‚úÖ
8. T√¢che #14 - Handler invitations
9. T√¢che #15 - API invite stats
10. Tester API avec Postman ‚úÖ

**Livrable:** "Membre X a invit√© 5 personnes"

---

### Sprint 3 - M√©triques (Semaine 4)
**Objectif:** Premier snapshot fonctionnel

**Ordre d'ex√©cution:**
1. T√¢che #19 - Table metrics_snapshots
2. T√¢che #20 - Table member_stats
3. T√¢che #16 - Service MetricsCollector
4. Tester service isol√©ment ‚úÖ
5. T√¢che #17 - Modifier messageCreate
6. T√¢che #18 - Listener voiceStateUpdate
7. T√¢che #22 - Init MetricsCollector au boot
8. Envoyer 50 messages ‚Üí attendre 1 min ‚Üí v√©rifier snapshot ‚úÖ
9. T√¢che #21 - Handler handleMetricsSnapshot
10. T√¢che #23 - Tests E2E m√©triques

**Livrable:** Snapshots toutes les minutes dans DB

---

### Sprint 4 - Dashboard (Semaine 5)
**Objectif:** Visualisation des stats

**Ordre d'ex√©cution:**
1. T√¢che #24 - API stats overview
2. Tester API ‚Üí v√©rifier donn√©es ‚úÖ
3. T√¢che #25 - API moderation recent
4. Tester API ‚úÖ
5. T√¢che #26 - Component GuildDashboard
6. Tester affichage avec vraies donn√©es ‚úÖ
7. T√¢che #27 - Component Leaderboard
8. Polish UI/UX

**Livrable:** Dashboard avec graphiques fonctionnels

---

### Sprint 5 - Finition (Semaine 6)
**Objectif:** Production ready

**Ordre d'ex√©cution:**
1. T√¢che #28 - Tests E2E complet
2. T√¢che #29 - Gestion erreurs
3. T√¢che #30 - Documentation
4. T√¢che #31 - Optimisation DB
5. T√¢che #32 - Tests charge
6. Beta test sur 5 serveurs r√©els
7. Corrections bugs
8. D√©ploiement

**Livrable:** MVP pr√™t pour production

---

## üêõ Probl√®mes connus et solutions

### Probl√®me : EventBatcher ne flush pas
**Cause:** Timer pas d√©marr√© ou config incorrecte  
**Solution:** V√©rifier `batchesConfig` a bien `maxWait` d√©fini, v√©rifier `ensureFlushTimer()` appel√©

### Probl√®me : Audit log ne retourne pas le mod√©rateur
**Cause:** Fetch trop tard (>5s apr√®s l'action)  
**Solution:** Fetch imm√©diatement dans le listener, v√©rifier timestamp

### Probl√®me : MetricsCollector perd des donn√©es
**Cause:** Flush avant que toutes les donn√©es soient collect√©es  
**Solution:** Augmenter `flushInterval` ou v√©rifier logique d'agr√©gation

### Probl√®me : Snapshot trop gros (>10MB)
**Cause:** Trop de membres actifs  
**Solution:** Limiter `maxTopMembers`, paginer, ou envoyer en plusieurs snapshots

### Probl√®me : DB slow sur requ√™tes agr√©g√©es
**Cause:** Index manquants  
**Solution:** Ajouter index sur colonnes filtr√©es/tri√©es, utiliser EXPLAIN ANALYZE

---

## üìä M√©triques de succ√®s

### Techniques

| M√©trique | Objectif | Critique |
|----------|----------|----------|
| Latence event critique | < 300ms | < 1s |
| Latence snapshot | < 2s | < 5s |
| Throughput events | 1000/s | 100/s |
| RAM Bot | < 512MB | < 2GB |
| CPU Bot | < 30% | < 70% |
| Pr√©cision compteurs | 100% | > 95% |

### Fonctionnelles

- [ ] Tous les bans/kicks logg√©s correctement
- [ ] Tracking invitations fonctionne √† 100%
- [ ] Snapshots g√©n√©r√©s toutes les minutes sans erreur
- [ ] Dashboard affiche donn√©es √† jour (< 2 min de retard)
- [ ] Top leaderboards corrects
- [ ] Tests E2E passent tous
- [ ] Z√©ro perte de donn√©es sur 48h
- [ ] Beta testeurs satisfaits (>8/10)

---

## üöÄ Prochaines √©tapes (apr√®s Phase 1)

### Phase 2 prioritaire
1. **Sharding bot** - Si > 2500 serveurs
2. **Cache Redis** - Optimisation requ√™tes fr√©quentes
3. **R√©actions d√©taill√©es** - Top emojis par membre
4. **Member activity snapshot** - Stats tous les membres (pas juste top 20)
5. **WebSocket Frontend** - Stats temps r√©el sans refresh

### Phase 3 - Features avanc√©es
1. **Syst√®me XP/Levels**
2. **Pr√©dictions analytics** (ML)
3. **Auto-mod√©ration intelligente**
4. **Rapports automatiques** (PDF export)
5. **API publique**

---

## üìû Support et questions

**Probl√®me technique ?** 
- Consulter `STATS_ARCHITECTURE.md` section correspondante
- V√©rifier les logs : `pm2 logs bot`, `pm2 logs backend`
- Tester isol√©ment le composant probl√©matique

**Besoin d'aide ?**
- Ouvrir une issue GitHub avec tag `stats`
- Documenter : t√¢che bloqu√©e, erreur exacte, steps to reproduce

**Am√©lioration de la roadmap ?**
- Ce document est vivant
- Proposer des changements via PR
- Ajouter des t√¢ches d√©couvertes en route

---

## üéâ C√©l√©bration des jalons

### üèÜ Jalon 1 - Mod√©ration (8 t√¢ches)
**Condition:** T√¢ches #1-8 compl√©t√©es  
**R√©compense:** Premier vrai use case fonctionnel ! üéä

### üèÜ Jalon 2 - Invitations (7 t√¢ches)
**Condition:** T√¢ches #9-15 compl√©t√©es  
**R√©compense:** Feature unique vs concurrents ! üöÄ

### üèÜ Jalon 3 - M√©triques (8 t√¢ches)
**Condition:** T√¢ches #16-23 compl√©t√©es  
**R√©compense:** C≈ìur du syst√®me stats fonctionne ! üí™

### üèÜ Jalon 4 - Dashboard (4 t√¢ches)
**Condition:** T√¢ches #24-27 compl√©t√©es  
**R√©compense:** Enfin visible pour les utilisateurs ! üé®

### üèÜ Jalon 5 - MVP Complet (5 t√¢ches)
**Condition:** T√¢ches #28-32 compl√©t√©es  
**R√©compense:** PR√äT POUR LA PRODUCTION ! üéâüéâüéâ

---

## üìà Graphique de progression

```
Semaine 1  ‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0/32 (0%)
Semaine 2  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 0/32 (0%)
Semaine 3  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 0/32 (0%)
Semaine 4  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 0/32 (0%)
Semaine 5  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 0/32 (0%)
Semaine 6  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 0/32 (0%)

Objectif final: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 32/32 (100%)
```

**Ce graphique sera mis √† jour √† chaque t√¢che compl√©t√©e** ‚úÖ

---

## üîÑ Historique des mises √† jour

### Version 1.0.0 (Octobre 2025)
- üìÖ Cr√©ation initiale de la roadmap
- üìã 32 t√¢ches Phase 1 d√©finies
- üìö Structure inspir√©e de security_roadmap.md
- üéØ Plan d'action sur 6 semaines √©tabli
- üìä Tableaux r√©capitulatifs cr√©√©s
- ‚úÖ Checklists de validation ajout√©es

### Version 1.0.1 (√Ä venir - apr√®s premi√®re t√¢che)
- ‚úÖ T√¢che #1 compl√©t√©e
- üìà Progression: 1/32 (3%)
- ...

---

## üéì Conseils pour travailler seul efficacement

### Organisation quotidienne
1. **Matin:** Choisir 1-2 t√¢ches du jour
2. **D√©velopper:** Focus sur la t√¢che sans distraction
3. **Tester:** Valider imm√©diatement (ne pas accumuler)
4. **Documenter:** Mettre √† jour roadmap + commit
5. **Review:** Relire code avant de merge

### Quand tu bloques
1. Faire une pause (15 min)
2. Relire STATS_ARCHITECTURE.md
3. Consulter les exemples de code
4. Tester en isolation (d√©couper le probl√®me)
5. Si toujours bloqu√© : documenter + passer √† autre chose

### Motivation
- ‚úÖ Cocher les cases est satisfaisant !
- üìà Voir la progression augmenter
- üéâ C√©l√©brer chaque jalon atteint
- üì∏ Faire des screenshots des milestones
- üöÄ Imaginer le produit final

### √âviter le burnout
- üéØ Max 2-3h de code intense par session
- ‚è∏Ô∏è Pause toutes les heures
- üèÉ Alterner code/doc/tests
- üåô Pas de code apr√®s 22h (fatigue = bugs)
- üéÆ R√©compense apr√®s chaque jalon

